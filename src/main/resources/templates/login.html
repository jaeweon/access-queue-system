<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N ë§Œëª… ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background-size: cover;
            background-position: center;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: relative;
        }

        /* ë¡œê·¸ì¸ ë°•ìŠ¤ */
        .login-container {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 350px;
        }

        h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 20px;
        }

        label {
            font-size: 14px;
            color: #333;
            display: block;
            margin-bottom: 5px;
            text-align: left;
        }

        input {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
        }

        button {
            background-color: #0056b3;
            color: #fff;
            padding: 10px 15px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }

        button:hover {
            background-color: #003d80;
        }

        .test-container {
            display: flex;
            justify-content: center;
            gap: 20px; /* ë²„íŠ¼ ê°„ì˜ ê°„ê²© */
            margin-top: 30px;
        }

        #test-button,
        #reset-button {
            flex: 1;
            max-width: 200px; /* ë²„íŠ¼ ìµœëŒ€ í¬ê¸° */
            padding: 12px 20px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
        }

        #test-button:hover {
            background-color: #cc0000;
        }

        /* ì¹´ìš´íŠ¸ë‹¤ìš´ í‘œì‹œ */
        #countdown-display {
            font-size: 24px;
            font-weight: bold;
            color: red;
            margin-top: 10px;
            display: none;
        }

        /* ğŸ”¹ ëª¨ë‹¬ ì°½ ìŠ¤íƒ€ì¼ */
        .modal {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* ë°°ê²½ ì–´ë‘¡ê²Œ */
            z-index: 1000;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            width: 650px;
            max-height: 80vh;
            border-radius: 10px;
            text-align: center;
            overflow-y: auto;
            position: relative;
        }

        .close-modal {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
        }

        /* ê°œë°œì ì •ë³´ */
        .developer-credit {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
        }
    </style>
</head>
<body>

<!-- ğŸ”¹ ëª¨ë‹¬ ì°½ -->
<div id="intro-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2>ğŸ“Œ Në§Œ ëª… ë™ì‹œ ì ‘ì† ëŒ€ê¸°ì—´ ì—°ìŠµ ì‹œìŠ¤í…œ</h2>
        <p>
            <strong>ì´ ì‹œìŠ¤í…œì€ ìˆ˜ê°• ì‹ ì²­ ë° ê²Œì„ ëŒ€ê¸°ì—´ ì ‘ì†ì„ ì—°ìŠµí•˜ê¸°</strong> ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.<br>
            ì‹¤ì œ í™˜ê²½ê³¼ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ ëŒ€ê¸°ì—´ì— ì§„ì…í•˜ëŠ” ê³¼ì •ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
        </p>
        <p>
            <strong>ì‚¬ìš© ë°©ë²•</strong><br>
            1. ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¼ë°˜ ë¡œê·¸ì¸ì„ ì§„í–‰í•˜ì„¸ìš”.<br>
            2. "ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ ì¹´ìš´íŠ¸ë‹¤ìš´ê³¼ ë™ì‹œì—<br>
            Në§Œ ëª…ì˜ ë™ì‹œ ì ‘ì† í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
            3. ì¹´ìš´íŠ¸ë‹¤ìš´ì´ ì¢…ë£Œë˜ë©´ ë¡œê·¸ì¸ì´ í—ˆìš©ë©ë‹ˆë‹¤.<br>
            4. <strong>í…ŒìŠ¤íŠ¸ ì¢…ë£Œ í›„, ë°˜ë“œì‹œ "í…ŒìŠ¤íŠ¸ ìƒˆë¡œ í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬</strong> ì‹œìŠ¤í…œì„ ì´ˆê¸°í™”í•˜ì„¸ìš”.<br>
        </p>
        <p>
            <strong>ì§„ì… í—ˆìš© ê¸°ì¤€</strong><br>
            ì ‘ì† ê°€ëŠ¥ ì—¬ë¶€ëŠ” ì‹¤ì‹œê°„ ë¶€í•˜ìœ¨ì— ë”°ë¼ ê²°ì •ë©ë‹ˆë‹¤.<br>
            ë¶€í•˜ìœ¨ ê³„ì‚° ë°©ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
        </p>
        <strong>ìš”ì²­ ê¸°ë°˜ ë¶€í•˜ìœ¨</strong><br>
                ë¶€í•˜ìœ¨ = <strong>ë‹¨ìœ„ ì‹œê°„ë‹¹ ìš”ì²­ ìˆ˜ / ì„œë²„ê°€ ì²˜ë¦¬ ê°€ëŠ¥í•œ ìµœëŒ€ ìš”ì²­ ìˆ˜</strong><br>
                (ê°’ì´ 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì„œë²„ ë¶€í•˜ê°€ ë†’ìŒ)<br><br>
        <strong>ì„œë²„ ìì› ê¸°ë°˜ ë¶€í•˜ìœ¨</strong><br>
                ë¶€í•˜ìœ¨ = <strong>(CPU ì‚¬ìš©ëŸ‰ + ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰) / ìµœëŒ€ ê°€ëŠ¥ ìì›</strong><br>
                ì˜ˆ: CPU 80%, ë©”ëª¨ë¦¬ 70% â†’ ë¶€í•˜ìœ¨ = 0.75<br><br>
        <strong>ëŒ€ê¸°ì—´ í¬ê¸° ê¸°ë°˜ ë¶€í•˜ìœ¨</strong><br>
                ë¶€í•˜ìœ¨ = <strong>í˜„ì¬ ëŒ€ê¸°ì—´ í¬ê¸° / ìµœëŒ€ ëŒ€ê¸°ì—´ í—ˆìš© í¬ê¸°</strong>
        <p>
            <strong>ë¶€í•˜ìœ¨ì— ë”°ë¥¸ ì ‘ì† ì²˜ë¦¬ëŸ‰ ì¡°ì •</strong><br>
            ë¶€í•˜ìœ¨ì´ ë†’ì„ìˆ˜ë¡ ì ‘ì† í—ˆìš© ì¸ì›ì„ ë™ì ìœ¼ë¡œ ì¡°ì •í•©ë‹ˆë‹¤.
        </p>
        <strong>ì„ í˜• ëª¨ë¸</strong>: maxAllowUserCount = <strong>ìµœëŒ€ ì²˜ë¦¬ëŸ‰ Ã— (1 - ë¶€í•˜ìœ¨)</strong><br>
        <strong>ë¹„ì„ í˜• ëª¨ë¸</strong>: maxAllowUserCount = <strong>ìµœëŒ€ ì²˜ë¦¬ëŸ‰ Ã— e<sup>-ë¶€í•˜ìœ¨</sup></strong><br>
                (ë¶€í•˜ìœ¨ì´ 0.5 ì´ìƒì¼ ë•Œ ì²˜ë¦¬ëŸ‰ ê¸‰ê²©íˆ ê°ì†Œ)
        <p>
            ì ‘ì† í—ˆìš© ì¸ì›ì€ ìœ„ ê³µì‹ì„ ê¸°ë°˜ìœ¼ë¡œ ë™ì ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
            ì—°ìŠµìš© ê³„ì •ìœ¼ë¡œ ì ‘ì†í•´ ë¶€í•˜ìœ¨ ë³€í™”ë¥¼ ì§ì ‘ ê²½í—˜í•´ë³´ì„¸ìš”!<br>
            <strong>* ì—°ìŠµìš© ê³„ì • ID: 1234 / PW: 1234</strong>
        </p>
        <p><strong>ğŸš€ ì¦ê±°ìš´ ì—°ìŠµ ë˜ì„¸ìš”! ğŸš€</strong></p>
    </div>
</div>

<h1 style="margin-bottom: 20px;">N ë§Œëª… ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ</h1>

<!-- ë¡œê·¸ì¸ í¼ -->
<div class="login-container">
    <h1>ëŒ€ê¸°ì—´ ë¡œê·¸ì¸</h1>
    <form id="login-form" action="/api/v1/auth/login" method="POST">
        <label for="username">ì•„ì´ë””:</label>
        <input type="text" id="username" name="username" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
        <label for="password">ë¹„ë°€ë²ˆí˜¸:</label>
        <input type="password" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
        <button type="submit">ë¡œê·¸ì¸</button>
    </form>
</div>

<!-- í…ŒìŠ¤íŠ¸ ë²„íŠ¼ & ì¹´ìš´íŠ¸ë‹¤ìš´ UI -->
<div class="test-container">
    <button id="test-button" style="background-color: #cc0000">ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
    <button id="reset-button">í…ŒìŠ¤íŠ¸ ìƒˆë¡œ í•˜ê¸°</button>
</div>
<div id="countdown-display"></div>

<!-- ê°œë°œì ì •ë³´ -->
<div class="developer-credit">Developed by Jae Weon Lee</div>
<script>
    let isTestRunning = false;
    const QUEUE_SERVER_URL = "http://waitingroom.reservate.click";

    document.addEventListener("DOMContentLoaded", () => {
        const modal = document.getElementById("intro-modal");
        const closeModal = document.querySelector(".close-modal");

        closeModal.addEventListener("click", () => {
            modal.style.display = "none";
        });
    });

    document.getElementById("test-button").addEventListener("click", () => {
        startCountdown(10);
    });

    document.getElementById("reset-button").addEventListener("click", () => {
        fetch(`${QUEUE_SERVER_URL}/api/v1/queue/flushAll`, { method: 'POST' })
            .then(response => response.text())
            .then(data => {
                alert("í…ŒìŠ¤íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            })
            .catch(error => {
                console.error("Redis ì´ˆê¸°í™” ì˜¤ë¥˜:", error);
                alert("ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            });
    });

    function startCountdown(seconds) {
        const countdownDisplay = document.getElementById("countdown-display");
        countdownDisplay.style.display = "block";
        let counter = seconds;
        isTestRunning = true;

        const interval = setInterval(() => {
            countdownDisplay.innerText = counter > 0 ? `í…ŒìŠ¤íŠ¸ ì‹œì‘ê¹Œì§€ ${counter}ì´ˆ` : "í…ŒìŠ¤íŠ¸ ì‹œì‘!";
            counter--;

            if (counter === 5) {
                fetch('/api/v1/loadtest/start', { method: 'POST' })
                    .then(response => response.text())
                    .then(data => {
                        console.log("k6 ì‹¤í–‰ ê²°ê³¼:", data);
                    })
                    .catch(error => {
                        console.error("k6 ì‹¤í–‰ ì˜¤ë¥˜:", error);
                    });
            }

            if (counter < 0) {
                isTestRunning = false;
                clearInterval(interval);
                countdownDisplay.style.display = "none";
            }
        }, 1000);
    }

    document.getElementById("login-form").addEventListener("submit", function (event) {
        if (isTestRunning) {
            event.preventDefault();
            alert("ì•„ì§ ìˆ˜ê°• ì‹ ì²­ ê¸°ê°„ì´ ì•„ë‹™ë‹ˆë‹¤. ì¹´ìš´íŠ¸ë‹¤ìš´ì´ ëë‚œ í›„ ë¡œê·¸ì¸í•˜ì„¸ìš”.");
        }
    });
</script>
</body>
</html>
